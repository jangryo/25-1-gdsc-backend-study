# 고급 백엔드 스터디 12주차

# Chapter 6. B-Tree Variants

## Bw-Trees 

- B-Tree의 제자리(in-place) 업데이트 구현의 세 가지 문제:
    1. 쓰기 증폭(write amplification):
        - 한 번의 논리적 변경에 대해 디스크 페이지 전체를 다시 써야 한다. 
        - SSD나 저장 장치에 특히 부담이다. 
    2. 공간 증폭(space amplification):
        - 한 페이지에 여유 공간 확보 필요 -> 데이터 효율 저하
    3. 동시성 문제(concurrency):
        - 다중 쓰레드 환경에서 락(lock)과 래치(latch)를 정교하게 다뤄야 한다. 
    
업데이트를 버퍼링하면 쓰기 및 공간 증폭 문제는 완화되지만, 동시성 문제에 대한 해결책은 제공하지 못한다. 

- 해결책: Buzzword-Tree(Bw-Tree)
    - 핵심 아이디어:
        1. append-only 로그 형태로 업데이트 기록
        2. 노드 연결(chain) -> 변경 사항을 체인처럼 연결
        3. CAS(Compare-And-Swap) -> 포인터 교체를 원자적으로 처리 -> 락 프리


### Update Chains

Bw-Tree는 기본 노드(base node)와 그에 대한 수정을 별도로 기록한다. 수정은 델타 노드(delta node) 형태로 체인을 형성하며, 가장 최신 수정부터 오래된 수정 순으로 연결 리스트를 이루며, 마지막에 기본 노드를 포함한다.

- 델타 체인 구조:
    - 각 노드의 수정 사항을 추가 전용 형태의 링크드 리스트로 관리
    - 기존 노드를 수정하지 않고, 새로운 노드를 앞에 붙이는 방식
    - 장점:
        - 쓰기 증폭 방지: 기존 디스크 노드를 수정하지 않음 